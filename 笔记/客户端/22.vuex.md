# Vuex
vue 体系的store数据变化后更新vue层，触发action 来修改数据。

## 1. 安装
npm i vuex -S

## 2. 文件结构

client/store/store.js

```javascript
import Vuex from 'vuex'
import Vue from 'vue'

Vue.use(Vuex) // 创建store之前调用

const store = new Vuex.Store({
  state: {
    count: 0
  },
  mutations: {
    updateCount (state, num) {
      state.count = num
    }
  }
})

export default store

```

## 3.根组件引入
树形结构，放到最外层所有节点都能拿到
client / entry.js
```javascript
import store from './store/store'
new Vue({
  router, // 挂载 router对象
  store,
  render: (h) => h(APP)
}).$mount('#root')
```
## 4. app.vue中使用

```jsx
<template>
  <p>{{count}}</p>
</template>
export default {
  components: {
    Header,
    Footer
    // Todo
  },
  data () {
    return {
      text: 'abc'
    }
  },
  computed: {
    count () {
      return this.$store.state.count
    }
  },
  mounted () {
    console.log(this.$route)
    console.log(this.$store)  // 插入APP的组件中
  }
}
```

## 4.修改state值 this.$store.commit

```javascript
mounted () {
  console.log(this.$route)
  console.log(this.$store)
  let i = 1
  setInterval(() => {
    // 调用 mutations
    this.$store.commit('updateCount', i++)
  }, 1000)
}
```

## 5. 创建store 
也要像route 一样，导出一个函数。使用服务端渲染，每次要新生成一个store，不能使用同一个store，会导致内存溢出。

store.js
```jsx
import Vuex from 'vuex'

export default () => {
  return new Vuex.Store({
    state: {
      count: 0
    },
    mutations: {
      updateCount (state, num) {
        state.count = num
      }
    }
  })
}

```

entry.js

```javascript
import createStore from './store/store'
import Vuex from 'vuex'

// 使用插件不需要创建Dom
// const root = document.createElement('div')
// document.body.appendChild(root)

// 如果使用模块化机制编程，导入Vue和VueRouter，要调用 Vue.use(VueRouter)
Vue.use(VueRouter) // vue插件的使用方式
Vue.use(Vuex)
const router = createRouter()
const store = createStore() // 创建store

```
